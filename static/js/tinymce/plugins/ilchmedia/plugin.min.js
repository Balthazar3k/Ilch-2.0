tinymce.PluginManager.add('ilchmedia', function(editor) {

	tinymce.activeEditor.settings.file_browser_callback = filemanager;

	function filemanager (id, value, type, win) {
		// DEFAULT AS FILE

		urltype='file';
		if (type==='image') { urltype='image'; }
		if (type==='media') { urltype='media'; }
                var title="Media";
                if (typeof editor.settings.filemanager_title !== "undefined" && editor.settings.filemanager_title) 
                    title=editor.settings.filemanager_title;
                var sort_by="";
                var descending="false";
		if (typeof editor.settings.filemanager_sort_by !== "undefined" && editor.settings.filemanager_sort_by) 
                    sort_by=editor.settings.filemanager_sort_by;
		if (typeof editor.settings.filemanager_descending !== "undefined" && editor.settings.filemanager_descending) 
                    descending=editor.settings.filemanager_descending;
		tinymce.activeEditor.windowManager.open({
			title: title,
                        classes:'ilchmedia',
			file: editor.settings.external_filemanager_path+'/inputid/'+id+'/type/'+urltype,
			width: 860,  
			height: 570,
			resizable: true,
			maximizable: true,
			inline: 1
			}, {});
	};
	return false;
});
